<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>D3: Experiment with Rain Data</title>
		<script type="text/javascript" src="../d3/d3.v3.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.js"></script>
		<style type="text/css">
			/* No style rules here yet */		
		</style>
	</head>
	<body>
		<script type="text/javascript">
			
			//Create SVG element
      var w = 500;
      var h = 300;
      var barPadding = 5;
      var scaleFactor = 1;

      var svg = d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h);

      d3.csv('rain.csv', function (data) {
        console.log(data);
        data = _.map(data, function (row) {
          return {
            Accumulation: Number.parseFloat(row.Accumulation),
            Days: Number.parseInt(row.Days),
            Date: new Date(row.Date)
          };
        });
        var maxValue = _.max(_.pluck(data, 'Accumulation'));
        scaleFactor = h / maxValue;
        console.log('max %d, scale %d', maxValue, scaleFactor);

        svg.selectAll('rect')
          .data(data)
          .enter()
          .append('rect')
          .attr({
            x: function (row, i) {
              var x = i * (w / data.length);
              console.log('x %d', x);
              return x;
            },
            y: function (row, i) {
              var y = h - row.Accumulation * scaleFactor;
              console.log('y %d', y);
              return y;
            },
            width: function (row, i) {
              var width = w / data.length - barPadding;
              console.log('width %d', width);
              return width;
            },
            height: function (row, i) {
              var height = row.Accumulation * scaleFactor;
              console.log('height %d', height);
              return height;
            }
          });

        svg.selectAll('text')
          .data(data)
          .enter()
          .append('text')
          .text(function (d) {
            return d.Days;
          })
          .attr({
            x: function (row, i) {
              var x = i * (w / data.length);
              console.log('x %d', x);
              return x;
            },
            y: function (row, i) {
              var y = h ;
              console.log('y %d', y);
              return y;
            }
          });
      });

		</script>
	</body>
</html>